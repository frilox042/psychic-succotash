---
date: 2020-09-17T15:29
---

# Serialization

## Cap'n Proto

[https://capnproto.org/](https://capnproto.org/)

Install from arch package

```shell
$ yay -S capnproto
```

### C++

Generate C++ headers

```shell
$ capnpc test.capnp -o c++
```

```shell
$ tree
.
|____test.capnp.h
|____test.capnp
|____test.capnp.c++
```

### Python

Install from pip

```shell
$ pip install pycapnp
```

Run in python

```python
import capnp
<...>
ImportError: <...>/capnp.cpython-38-x86_64-linux-gnu.so: undefined symbol: _ZN2kj1_24TransformPromiseNodeBase7onReadyERNS0_5EventE
```

It does not seem to work well for python.

Also, it does not work by generating python files with classes like protobuf or flatbuffers does.
Those python files are helpful because they can be used for autocompletion while coding.
Cap'n Proto seems to only rely on reflection.

## Protobuf

[https://developers.google.com/protocol-buffers/](https://developers.google.com/protocol-buffers/)

Install from arch package

```shell
$ yay -S protobuf
```

### C++

Generate C++ headers

```shell
$ protoc test.proto --cpp_out=. 
```

```
$ tree
.
|____test.proto
|____test.pb.h
|____test.pb.cc
```

### Python

Generate python code

```shell
$ protoc test.proto --python_out=. 
```

```shell
$ tree
.
|____test_pb2.py
|____test.proto
```

#### Some Test

Install python protobuf package

```shell
$ pip install protobuf
```

Play with the generated code from proto file

```python
from test_pb2 import Person

person = Person()
person.IsInitialized() # False
p.id = 123
p.name = 'test'
person.IsInitialized() # True
p.SerializeToString()  # b'\n\x04test\x10{'
Person().FromString(p.SerializeToString()) == person # True
```

## Flatbuffers

[https://google.github.io/flatbuffers/](https://google.github.io/flatbuffers/)

```shell
$ yay -S flatbuffers
```

### C++

Generate C++ headers

```shell
$ flatc --cpp test.fbs 
```

```shell
tree
.
|____test_generated.h
|____test.fbs
```

### Python

Generate python code

```shell
$ flatc --python test.fbs 
```

```shell
tree
.
MyGame
|______init__.py
|____Sample
| |____Color.py
| |______init__.py
| |____Monster.py
| |____Weapon.py
| |____Equipment.py
| |____Vec3.py
|____test.fbs
```
